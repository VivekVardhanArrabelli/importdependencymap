/* ... Keeping previous root variables ... */
:root {
  /* Light Mode (Default) - Marble & Bronze */
  --bg-body: #fcfbf9;
  --bg-panel: #ffffff;
  --bg-subtle: #f5f2ed;
  --text-main: #1a1a1a;
  --text-muted: #5d5d5d;
  --text-gold: #9f803e;
  --accent-gold: #d4af37;
  --accent-gold-dim: #aa8c2c;
  --accent-blue: #2c3e50;
  --accent-alert: #8b0000;
  --border-light: #e6e1d8;
  --border-strong: #d1c7b7;
  --frame-bg: #fff;
  --toast-bg: #1a1a1a;
  --toast-text: #fff;
  --drawer-bg: #ffffff;
  --svg-opacity: 0.15;
  --filter-svg: none;

  /* Typography */
  --font-header: 'Playfair Display', serif;
  --font-brand: 'Cinzel', serif;
  --font-body: 'Tenor Sans', sans-serif;
  
  /* Shadows */
  --shadow-card: 0 4px 20px rgba(26, 26, 26, 0.04);
  --shadow-hover: 0 10px 30px rgba(26, 26, 26, 0.08);
  --shadow-drawer: -5px 0 30px rgba(0,0,0,0.15);
  
  --radius-sm: 2px;
  --radius-md: 4px;
  
  --container-width: 1600px;
  --header-height: 70px;
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg-body: #0a0a0a;
    --bg-panel: #121212;
    --bg-subtle: #1a1a1a;
    --text-main: #e0e0e0;
    --text-muted: #a0a0a0;
    --text-gold: #c5a059;
    --accent-gold: #d4af37;
    --accent-gold-dim: #c5a059;
    --accent-blue: #4a6fa5;
    --accent-alert: #ff4d4d;
    --border-light: #333333;
    --border-strong: #444444;
    --frame-bg: #121212;
    --drawer-bg: #121212;
    --toast-bg: #e0e0e0;
    --toast-text: #0a0a0a;
    --svg-opacity: 0.05;
    --filter-svg: invert(1);
  }
}

/* Base Reset */
*, *::before, *::after { box-sizing: border-box; }

body {
  margin: 0;
  font-family: var(--font-body);
  background-color: var(--bg-body);
  color: var(--text-main);
  line-height: 1.6;
  background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23d1c7b7' fill-opacity='0.15' fill-rule='evenodd'/%3E%3C/svg%3E");
  overflow-x: hidden; /* Prevent horizontal scroll from drawer */
}

h1, h2, h3, h4 { font-family: var(--font-header); font-weight: 400; color: var(--text-main); margin: 0; }
h2.section-title { font-size: 1.25rem; text-transform: uppercase; letter-spacing: 0.1em; border-bottom: 1px solid var(--border-light); padding-bottom: 0.5rem; margin-bottom: 1.5rem; display: block; }
h2.section-title.small { font-size: 0.9rem; border-bottom: none; margin-bottom: 1rem; color: var(--text-muted); }

.skip-link { position: absolute; top: -100px; left: 0; background: var(--text-main); color: var(--bg-body); padding: 1rem; z-index: 9999; }
.skip-link:focus { top: 0; }

/* App Layout */
.app-container { display: flex; flex-direction: column; min-height: 100vh; }

.topbar {
  height: var(--header-height);
  display: flex; justify-content: space-between; align-items: center;
  padding: 0 2rem; background: rgba(252, 251, 249, 0.95);
  border-bottom: 1px solid var(--border-light);
  position: sticky; top: 0; z-index: 100;
  backdrop-filter: blur(10px);
}
@media (prefers-color-scheme: dark) { .topbar { background: rgba(18, 18, 18, 0.95); } }

.brand { font-family: var(--font-brand); display: flex; align-items: center; gap: 0.8rem; font-size: 1.1rem; color: var(--text-main); text-transform: uppercase; }
.brand small { display: block; font-family: var(--font-body); font-size: 0.6rem; color: var(--text-gold); letter-spacing: 0.1em; }
.brand__logo { font-size: 1.4rem; }

.nav-link {
  background: none; border: none; padding: 0.5rem 1rem;
  font-family: var(--font-body); text-transform: uppercase; letter-spacing: 0.1em;
  color: var(--text-muted); cursor: pointer; position: relative;
}
.nav-link.active { color: var(--text-main); font-weight: 600; }
.nav-link::after { content: ''; position: absolute; bottom: 0; left: 50%; width: 0; height: 2px; background: var(--accent-gold); transition: 0.3s; transform: translateX(-50%); }
.nav-link.active::after, .nav-link:hover::after { width: 80%; }

/* Main Content Area */
main { flex: 1; padding: 2rem; max-width: var(--container-width); margin: 0 auto; width: 100%; }

.view-section { display: none; animation: fadeIn 0.4s ease; }
.view-section.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* Dashboard Layout */
.dashboard-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 2rem; border-bottom: 1px solid var(--border-strong); padding-bottom: 1.5rem; }
.hero__title { font-size: 2.5rem; line-height: 1; }
.hero__actions { display: flex; gap: 1rem; }

/* Stats Grid */
.stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 3rem; }
.stat-card { padding: 1.5rem; background: var(--bg-panel); border: 1px solid var(--border-light); text-align: center; }
.stat-card.alert { border-color: var(--accent-alert); }
.stat-card h3 { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 0.5rem; }
.stat-card p { font-size: 2rem; font-family: var(--font-header); color: var(--text-main); }
.stat-label { font-size: 0.7rem; color: var(--text-gold); font-style: italic; }

/* Content Layout (3 Columns) */
.content-layout { display: grid; grid-template-columns: 260px 1fr 260px; gap: 2rem; align-items: start; }

/* Sidebar Filters */
.sidebar-filters .panel { background: var(--bg-panel); padding: 1.5rem; border: 1px solid var(--border-light); margin-bottom: 1.5rem; }
.sidebar-filters .sticky { position: sticky; top: calc(var(--header-height) + 2rem); z-index: 10; }

.input-group { margin-bottom: 1rem; }
.input-group-row { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
.input-group-row > div { flex: 1; }
label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); display: block; margin-bottom: 0.3rem; }
input, select, textarea { width: 100%; background: transparent; border: none; border-bottom: 1px solid var(--border-strong); padding: 0.5rem 0; font-family: var(--font-header); font-size: 0.95rem; color: var(--text-main); border-radius: 0; }
input:focus, select:focus { outline: none; border-color: var(--accent-gold); }
input::placeholder { opacity: 0.4; font-style: italic; }

/* Main Results */
.results-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
.view-toggles { display: flex; gap: 0.5rem; }
.icon-btn { background: none; border: 1px solid var(--border-light); cursor: pointer; padding: 0.4rem; color: var(--text-muted); font-size: 1.2rem; line-height: 1; }
.icon-btn.active { background: var(--bg-subtle); color: var(--text-main); border-color: var(--text-main); }

/* Cards Grid */
.cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1.5rem; }
.card { background: var(--bg-panel); border: 1px solid var(--border-light); padding: 1.5rem; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; display: flex; flex-direction: column; position: relative; }
.card:hover { transform: translateY(-3px); box-shadow: var(--shadow-hover); border-color: var(--accent-gold); }
.card h3 { font-size: 0.9rem; display: flex; justify-content: space-between; margin-bottom: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; }
.card .meta { font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem; }
.chips { flex-grow: 1; display: flex; flex-wrap: wrap; gap: 0.4rem; margin: 0.8rem 0; }
.chip { font-size: 0.6rem; text-transform: uppercase; border: 1px solid var(--border-light); padding: 0.2rem 0.5rem; color: var(--text-muted); }

/* Data Table */
.table-container { overflow-x: auto; background: var(--bg-panel); border: 1px solid var(--border-light); }
.data-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
.data-table th { text-align: left; padding: 1rem; border-bottom: 1px solid var(--text-main); font-weight: normal; color: var(--text-muted); text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.05em; }
.data-table td { padding: 0.8rem 1rem; border-bottom: 1px solid var(--border-light); font-family: var(--font-header); cursor: pointer; }
.data-table tr:hover td { background: var(--bg-subtle); }
.text-right { text-align: right; }
.hidden { display: none; }

/* Right Sidebar Extras */
.compact-list { list-style: none; padding: 0; margin: 0; }
.compact-list li { padding: 0.8rem 0; border-bottom: 1px solid var(--border-light); font-size: 0.85rem; display: flex; justify-content: space-between; }
.compact-list strong { font-family: var(--font-brand); color: var(--text-main); font-weight: normal; }
.compact-list span { color: var(--text-muted); }

/* Drawer (Detail View) */
.drawer-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 500; backdrop-filter: blur(2px); }
.drawer { position: fixed; top: 0; right: 0; width: 600px; max-width: 90%; height: 100%; background: var(--drawer-bg); z-index: 600; box-shadow: var(--shadow-drawer); display: flex; flex-direction: column; transition: transform 0.3s ease; transform: translateX(100%); }
.drawer.open { transform: translateX(0); }
.drawer-header { padding: 1.5rem; border-bottom: 1px solid var(--border-light); display: flex; justify-content: space-between; align-items: center; background: var(--bg-subtle); }
.drawer-header h2 { font-size: 1.2rem; }
.close-btn { background: none; border: none; font-size: 2rem; cursor: pointer; line-height: 1; color: var(--text-muted); }
.drawer-content { flex: 1; overflow-y: auto; padding: 2rem; }

.drawer-actions { display: flex; justify-content: flex-end; margin-bottom: 1.5rem; }
.insight-block { margin-bottom: 2rem; }
.frame { border: 1px solid var(--border-light); padding: 1rem; background: var(--frame-bg); margin-bottom: 2rem; height: 250px; }
.serif-list li { display: flex; justify-content: space-between; padding: 0.6rem 0; border-bottom: 1px dashed var(--border-light); font-family: var(--font-header); }
.chart-donut-small { height: 180px; width: 100%; display: flex; justify-content: center; margin-bottom: 1rem; }

.drawer-section { background: var(--bg-subtle); padding: 1.5rem; margin-top: 2rem; border: 1px solid var(--border-light); }
.small-gap { gap: 1rem; }

/* Community View */
.community-layout { max-width: 800px; margin: 0 auto; }
.community-grid { display: grid; gap: 1.5rem; list-style: none; padding: 0; }
.community-grid li { background: var(--bg-panel); padding: 1.5rem; border: 1px solid var(--border-light); }

/* Buttons General */
.btn { padding: 0.8rem 1.5rem; border: 1px solid var(--text-main); background: transparent; color: var(--text-main); text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.8rem; cursor: pointer; transition: 0.2s; font-family: var(--font-brand); }
.btn.primary { background: var(--text-main); color: var(--bg-body); }
.btn.primary:hover { background: var(--accent-gold); border-color: var(--accent-gold); color: #fff; }
.btn.outline:hover { background: var(--bg-subtle); border-color: var(--accent-gold); color: var(--text-gold); }
.btn.full { width: 100%; }
.btn.small { padding: 0.5rem 1rem; font-size: 0.7rem; }

/* Responsive */
@media (max-width: 1100px) {
  .content-layout { grid-template-columns: 240px 1fr; }
  .sidebar-extras { display: none; }
  .stats-grid { grid-template-columns: repeat(2, 1fr); }
}
@media (max-width: 800px) {
  .content-layout { display: flex; flex-direction: column; }
  .sidebar-filters { width: 100%; }
  .sidebar-filters .sticky { position: static; }
  .stats-grid { grid-template-columns: 1fr; }
  .hero__actions { width: 100%; flex-direction: column; }
}
